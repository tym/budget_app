{% extends 'base.html' %}

{% block content %}
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Get the year and month from Flask variables
        const year = {{ year | int }};
        const month = {{ month | int }};
    
        // Initialize currentDate with the passed year and month
        currentDate.setFullYear(year);
        currentDate.setMonth(month - 1); // Adjust for zero-indexed month
        console.log(`Initial currentDate: ${currentDate}`);
    
        // Update the page header to display the current month and year
        document.getElementById('current-month').textContent = currentDate.toLocaleDateString('default', {
            year: 'numeric', month: 'long'
        });

        // Fetch day data and populate the calendar
        const url = `/budget/get-day-data?year=${year}&month=${month}`;
        axios.get(url)
            .then(response => {
                const day_data = response.data;
                console.log("Day Data:", day_data);
                if (typeof populateCalendar === 'function') {
                    populateCalendar(year, month, day_data);
                } else {
                    console.error('populateCalendar function is not defined.');
                }
            })
            .catch(error => {
                console.error("Error fetching day_data:", error);
            });
    });
</script>

<div class="main-container">
    <section class="calendar-section">
        <div class="calendar-header">
            <button id="prev-month-btn">&lt; Previous</button>
            <h2 id="current-month"></h2> <!-- Dynamically updated -->
            <button id="next-month-btn">Next &gt;</button>
        </div>
        <div class="calendar-layout">
            <div class="weekly-labels"></div> <!-- Container for dynamic labels -->
            <div id="calendar-grid" class="calendar-grid"></div>
        </div>
    </section>

    <!-- Modal -->
    <div class="modal fade" id="dayModal" tabindex="-1" aria-labelledby="dayModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <!-- This is where the details of the day will be injected dynamically -->
                    <div id="day-details-content">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
  
    <!-- Table displaying budget details -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Expected Date</th>
                    <th>Actual Date</th>
                    <th>Expected Amount</th>
                    <th>Actual Amount</th>
                    <th>Cleared</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in budget_entries %}
                <tr>
                    <td>{{ entry.entry_type }}</td>
                    <td>{{ entry.description }}</td>
                    <td>{{ entry.expected_date.strftime('%m/%d/%Y') }}</td>
                    <td>
                        {% if entry.actual_date %}
                            {{ entry.actual_date.strftime('%m/%d/%Y') }}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </td>
                    <td>{{ entry.expected_amount }}</td>
                    <td>
                        {% if entry.actual_amount %}
                            {{ entry.actual_amount }}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </td>
                    <td>
                        {% if entry.cleared %}
                            Yes
                        {% else %}
                            No
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Include jQuery and Calendar.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='calendar.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</div>
{% endblock %}
